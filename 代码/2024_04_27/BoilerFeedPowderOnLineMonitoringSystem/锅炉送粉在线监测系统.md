# 锅炉送粉在线监测系统

> 程序功能:

-  一次风燃烧器出口风速在线监测；
-  一次风管煤粉浓度在线监测；
-  一次风粉模拟切圆；
-  一次风浓度和速度半小时实时趋势图及两小时历史趋势图；
-  一次风管温度在线监测;
-  1000次报警数据纪录;
-  入炉煤量纪录。

> 程序环境

VS2022, QT5.14.2版本, C++11

# 软件模块

主要分为四个模块.

- 系统设置
- 状态查看
- 数据处理
- 帮助

# 程序启动

程序启动后, 优先启动"欢迎界面",由于所有的功能都在主界面上,此时main函数需要做一定的处理.

![image-20240522195710259](https://raw.githubusercontent.com/qkja/PicGo/main/202405221957216.png)

```cpp
#include "BoilerFeedPowderOnLineMonitoringSystem.h"
#include <QtWidgets/QApplication>

int main(int argc, char* argv[])
{
	QApplication a(argc, argv);
	BoilerFeedPowderOnLineMonitoringSystem w; // 实例化所有功能的类
	w.hide();   // 主页面暂时先隐藏
	return a.exec();
}
```

暂时简绍一下**BoilerFeedPowderOnLineMonitoringSystem**类,这是所有功能的集合,其中WelcomeScreen是欢迎界面,它存在ui文件.

```cpp
class BoilerFeedPowderOnLineMonitoringSystem : public QMainWindow
{
	Q_OBJECT

public:
	BoilerFeedPowderOnLineMonitoringSystem(QWidget* parent = nullptr);
	~BoilerFeedPowderOnLineMonitoringSystem();

	void init();
    void initWelcomeScreen();  // 
private:
	Ui::BoilerFeedPowderOnLineMonitoringSystemClass* ui;

	WelcomeScreen* _welcome_screen;   //   欢迎界面

};
```

为了优先显示欢迎界面,此时需要在构造函数中进行处理

```cpp
BoilerFeedPowderOnLineMonitoringSystem::BoilerFeedPowderOnLineMonitoringSystem(QWidget* parent)
	: QMainWindow(parent)
	, ui(new Ui::BoilerFeedPowderOnLineMonitoringSystemClass())
	, _welcome_screen(nullptr)
{
	ui->setupUi(this);
    init();
}
// 欢迎界面
void BoilerFeedPowderOnLineMonitoringSystem::initWelcomeScreen()
{
	if (_welcome_screen == nullptr)
		_welcome_screen = new WelcomeScreen(nullptr);

	connect(_welcome_screen, &WelcomeScreen::welcomeScreenCloseSignals, [=]() {
		// 一般而言,我们欢迎界面只出现一次,
		// 一旦我们选择叉掉这个界面,可以认为是整个程序都要退出
		_welcome_screen = nullptr;
		this->close();
		});
	//设置子窗体属性：关闭即销毁
	_welcome_screen->setAttribute(Qt::WA_DeleteOnClose);
	_welcome_screen->show();

	// 欢迎界面到 主界面
	connect(_welcome_screen, &WelcomeScreen::fromWelToMianScreenSignals, [=]() {
		this->show();
		_welcome_screen->hide();
		});
}
```

对于QT而言, 欢迎窗口由于是最先出现的,后面就不会出现了.此时需要设置窗口一经关闭就立马释放资源,避免内存泄漏.

```cpp
	_welcome_screen->setAttribute(Qt::WA_DeleteOnClose);
```

# 欢迎界面

```cpp
class WelcomeScreen : public QWidget
{
	Q_OBJECT

public:
	WelcomeScreen(QWidget* parent = nullptr);
	~WelcomeScreen();
protected slots:
	void onButtonDoubleClicked();       // 点击按钮触发的槽函数
	void resetClickCount();             // 重置计数器
signals:
	void fromWelToMianScreenSignals();  // 双击之后,触发这个信号,转到主界面
	void welcomeScreenCloseSignals();   // 窗口关闭时,触发这个函数
protected:
	void closeEvent(QCloseEvent*);      // 重写窗口关闭的函数

private:
	Ui::WelcomeScreenClass* ui;
	QTimer* _doubleClickTimer;          // 时间控件
	int _clickCount;                    // 点击的计数器
};

WelcomeScreen::WelcomeScreen(QWidget* parent)
	: QWidget(parent)
	, ui(new Ui::WelcomeScreenClass())
	, _doubleClickTimer(new QTimer(this))
	, _clickCount(0)
{
	ui->setupUi(this);
	std::cout << "WelcomeScreen()" << std::endl;
	init();
}

void WelcomeScreen::init()
{
	// 窗口设置标题
	this->setWindowTitle("欢迎界面");
	// 检测鼠标的双击事件
	_doubleClickTimer->setInterval(QApplication::doubleClickInterval());
	connect(_doubleClickTimer, &QTimer::timeout, this, &WelcomeScreen::resetClickCount);
	connect(ui->welcome_pushButton, &QPushButton::clicked, this, &WelcomeScreen::onButtonDoubleClicked);
}
```



下面是代码的一些细节.其中为了实现鼠标双击事件,这里使用了一个定时器.

```cpp
_doubleClickTimer->setInterval(QApplication::doubleClickInterval());
```

1. `_doubleClickTimer` 是一个定时器对象,用于监测鼠标的双击事件。
2. `setInterval()` 方法用于设置定时器的间隔时间,单位为毫秒。
3. `QApplication::doubleClickInterval()` 是一个静态方法,它返回当前系统中定义的双击间隔时间。这个时间是用户在操作系统中设置的双击延迟时间,通常在 300-500 毫秒之间。
4. 将 `QApplication::doubleClickInterval()` 的返回值传给 `setInterval()` 方法,可以确保定时器的间隔时间与系统设置的双击延迟时间一致。这样可以确保程序能够正确地检测到用户的双击事件。



# 系统设置

